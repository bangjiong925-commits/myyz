<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Railway API è¿æ¥æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success {
            background-color: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        .info {
            background-color: #d1ecf1;
            border-color: #bee5eb;
            color: #0c5460;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        pre {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 3px;
            overflow-x: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Railway API è¿æ¥æµ‹è¯•</h1>
        <p>æµ‹è¯• TWPK ç½‘é¡µä¸ Railway äº‘æœåŠ¡çš„è¿æ¥çŠ¶æ€</p>
        
        <div class="test-section">
            <h3>API åŸºç¡€ä¿¡æ¯</h3>
            <p><strong>API åŸºç¡€URL:</strong> <span id="apiBase">https://twpk.up.railway.app</span></p>
            <p><strong>æµ‹è¯•æ—¶é—´:</strong> <span id="testTime"></span></p>
        </div>

        <div class="test-section">
            <h3>è¿æ¥æµ‹è¯•</h3>
            <button onclick="testHealth()">æµ‹è¯•å¥åº·æ£€æŸ¥ (/api/health)</button>
            <button onclick="testTaiwanData()">æµ‹è¯•å°æ¹¾PK10æ•°æ® (/api/taiwan-pk10-data)</button>
            <button onclick="testTodayData()">æµ‹è¯•ä»Šæ—¥æ•°æ® (/api/today-data)</button>
            <button onclick="testAllEndpoints()">æµ‹è¯•æ‰€æœ‰ç«¯ç‚¹</button>
        </div>

        <div id="results"></div>
    </div>

    <script>
        const API_BASE = 'https://twpk.up.railway.app';
        
        document.getElementById('apiBase').textContent = API_BASE;
        document.getElementById('testTime').textContent = new Date().toLocaleString();

        function addResult(title, content, type = 'info') {
            const resultsDiv = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `test-section ${type}`;
            div.innerHTML = `
                <h4>${title}</h4>
                <pre>${content}</pre>
                <small>æµ‹è¯•æ—¶é—´: ${new Date().toLocaleTimeString()}</small>
            `;
            resultsDiv.appendChild(div);
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }

        async function testEndpoint(endpoint, description) {
            const url = `${API_BASE}${endpoint}`;
            const startTime = Date.now();
            
            try {
                console.log(`å¼€å§‹æµ‹è¯•: ${url}`);
                
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const endTime = Date.now();
                const duration = endTime - startTime;
                
                let result = `URL: ${url}\n`;
                result += `çŠ¶æ€ç : ${response.status} ${response.statusText}\n`;
                result += `å“åº”æ—¶é—´: ${duration}ms\n`;
                result += `Content-Type: ${response.headers.get('content-type')}\n`;
                result += `\nå“åº”å¤´ä¿¡æ¯:\n`;
                
                for (let [key, value] of response.headers.entries()) {
                    result += `  ${key}: ${value}\n`;
                }
                
                if (response.ok) {
                    try {
                        const text = await response.text();
                        result += `\nå“åº”ä½“é•¿åº¦: ${text.length} å­—ç¬¦\n`;
                        
                        if (text.trim()) {
                            try {
                                const data = JSON.parse(text);
                                result += `\nå“åº”æ•°æ® (JSON):\n${JSON.stringify(data, null, 2)}`;
                                
                                if (Array.isArray(data)) {
                                    result += `\n\næ•°ç»„é•¿åº¦: ${data.length}`;
                                    if (data.length > 0) {
                                        result += `\nç¬¬ä¸€é¡¹: ${JSON.stringify(data[0], null, 2)}`;
                                    }
                                }
                            } catch (jsonError) {
                                result += `\nå“åº”æ•°æ® (æ–‡æœ¬):\n${text.substring(0, 500)}${text.length > 500 ? '...' : ''}`;
                            }
                        } else {
                            result += `\nâš ï¸ å“åº”ä½“ä¸ºç©º`;
                        }
                        
                        addResult(`âœ… ${description}`, result, 'success');
                    } catch (textError) {
                        result += `\nâŒ è¯»å–å“åº”ä½“å¤±è´¥: ${textError.message}`;
                        addResult(`âš ï¸ ${description}`, result, 'error');
                    }
                } else {
                    result += `\nâŒ HTTPé”™è¯¯: ${response.status} ${response.statusText}`;
                    addResult(`âŒ ${description}`, result, 'error');
                }
                
            } catch (error) {
                const endTime = Date.now();
                const duration = endTime - startTime;
                
                let result = `URL: ${url}\n`;
                result += `é”™è¯¯ç±»å‹: ${error.name}\n`;
                result += `é”™è¯¯ä¿¡æ¯: ${error.message}\n`;
                result += `è¯·æ±‚æ—¶é—´: ${duration}ms\n`;
                
                if (error.name === 'TypeError' && error.message.includes('fetch')) {
                    result += `\nå¯èƒ½çš„åŸå› :\n- ç½‘ç»œè¿æ¥é—®é¢˜\n- CORS ç­–ç•¥é™åˆ¶\n- æœåŠ¡å™¨ä¸å¯è¾¾`;
                }
                
                addResult(`âŒ ${description}`, result, 'error');
            }
        }

        async function testHealth() {
            await testEndpoint('/api/health', 'å¥åº·æ£€æŸ¥');
        }

        async function testTaiwanData() {
            await testEndpoint('/api/taiwan-pk10-data', 'å°æ¹¾PK10æ•°æ®');
        }

        async function testTodayData() {
            await testEndpoint('/api/today-data', 'ä»Šæ—¥æ•°æ®');
        }

        async function testAllEndpoints() {
            document.getElementById('results').innerHTML = '';
            addResult('ğŸš€ å¼€å§‹å…¨é¢æµ‹è¯•', 'æ­£åœ¨æµ‹è¯•æ‰€æœ‰APIç«¯ç‚¹...', 'info');
            
            await testHealth();
            await new Promise(resolve => setTimeout(resolve, 1000)); // 1ç§’å»¶è¿Ÿ
            
            await testTaiwanData();
            await new Promise(resolve => setTimeout(resolve, 1000)); // 1ç§’å»¶è¿Ÿ
            
            await testTodayData();
            
            addResult('âœ… æµ‹è¯•å®Œæˆ', 'æ‰€æœ‰APIç«¯ç‚¹æµ‹è¯•å·²å®Œæˆ', 'success');
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œä¸€æ¬¡åŸºç¡€æµ‹è¯•
        window.addEventListener('load', function() {
            setTimeout(() => {
                addResult('ğŸ”„ è‡ªåŠ¨æµ‹è¯•', 'é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹è‡ªåŠ¨æµ‹è¯•...', 'info');
                testHealth();
            }, 1000);
        });
    </script>
</body>
</html>