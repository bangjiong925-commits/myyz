<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>台湾PK数据分析工具</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  
  <!-- Tailwind配置 -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#3b82f6',
            secondary: '#10b981'
          }
        }
      }
    }
  </script>
  
  
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .sticky-header {
    position: sticky;
    top: 0;
    z-index: 100;
  }
  .sticky-col {
    position: sticky;
    z-index: 50;
  }
      .scrollbar-hide::-webkit-scrollbar {
        display: none;
      }
      .scrollbar-hide {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      .hit-cell {
        @apply bg-primary/20 text-primary font-bold;
      }
      .miss-cell {
        @apply text-gray-400;
      }
      .btn-active {
        @apply bg-primary text-white;
      }
      .btn-hover {
        @apply hover:bg-primary/80 hover:text-white transition-colors duration-200;
      }
      .number-row {
        @apply flex justify-center space-x-1 mb-1;
      }
      .fixed-width-period {
        width: 120px;
      }
      .fixed-width-data {
        width: 150px;
      }
      .sticky-bg-white {
        background-color: white !important;
      }
      .sticky-bg-gray-100 {
        background-color: #f3f4f6 !important;
      }
      
      /* 自定义滚动条样式 */
      .scrollbar-thin {
        scrollbar-width: thin;
      }
      
      .scrollbar-thin::-webkit-scrollbar {
        width: 6px;
        height: 6px;
      }
      
      .scrollbar-thumb-gray-300::-webkit-scrollbar-thumb {
        background-color: #d1d5db;
        border-radius: 3px;
      }
      
      .scrollbar-thumb-gray-300::-webkit-scrollbar-thumb:hover {
        background-color: #9ca3af;
      }
      
      .scrollbar-track-gray-100::-webkit-scrollbar-track {
        background-color: #f3f4f6;
        border-radius: 3px;
      }
      
      /* 黄金切割结果容器样式 */
      #goldenResults {
        scroll-behavior: smooth;
      }
      
      #goldenResults::-webkit-scrollbar {
        height: 8px;
      }
      
      #goldenResults::-webkit-scrollbar-track {
        background: #f1f5f9;
        border-radius: 4px;
      }
      
      #goldenResults::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 4px;
      }
      
      #goldenResults::-webkit-scrollbar-thumb:hover {
        background: #94a3b8;
      }
      .sticky-bg-gray-50 {
        background-color: #f9fafb !important;
      }
      .slider-container {
        @apply relative h-6 mt-2 mb-4;
      }
      .slider-track {
        @apply absolute h-2 w-full bg-gray-200 rounded-full;
      }
      .slider-thumb {
        @apply absolute w-5 h-5 bg-primary rounded-full cursor-pointer -mt-1.5 -ml-2.5;
      }
      .slider-fill {
        @apply absolute h-2 bg-primary rounded-full;
      }
      .vertical-slider-container {
        @apply absolute right-0 top-0 h-full w-4 flex items-center justify-center z-10;
      }
      .vertical-slider-track {
        @apply absolute h-full w-1 bg-gray-200 rounded-full;
      }
      .vertical-slider-thumb {
        @apply absolute w-4 h-6 bg-primary rounded-md cursor-pointer -ml-1.5;
      }
      .vertical-slider-fill {
        @apply absolute w-1 bg-primary rounded-full;
      }
      /* 限制表格容器高度，最多显示11行 */
      .table-container {
        max-height: calc(11 * 52px); /* 每行约52px高度 */
        overflow-y: auto;
        position: relative;
      }
    }
  </style>
</head>
<body class="bg-gray-50 font-sans text-dark min-h-screen flex flex-col">
  <!-- 密钥倒计时通知栏 -->
  <div id="keyCountdown" class="bg-primary text-white py-2 px-4 text-center hidden">
    <span>密钥有效期剩余: <strong id="timeRemaining">0天 0小时 0分钟 0秒</strong></span>
  </div>
  
  <!-- 顶部导航 -->
  <header class="bg-white shadow-sm sticky-header">
  <!-- 标题区域 - 移至最顶部 -->
  <div class="container mx-auto px-4 py-3 flex flex-wrap items-center justify-between">
      <h1 class="text-xl md:text-2xl font-bold text-primary flex items-center">
        <i class="fa fa-line-chart mr-2"></i>台湾PK数据分析工具
      </h1>
      <div class="flex items-center space-x-2 mt-2 md:mt-0">
        <button id="helpBtn" class="p-2 rounded-full hover:bg-gray-100 transition-colors duration-200" title="帮助">
          <i class="fa fa-question-circle text-gray-500"></i>
        </button>
        <button id="themeToggle" class="p-2 rounded-full hover:bg-gray-100 transition-colors duration-200" title="切换主题">
          <i class="fa fa-moon-o text-gray-500"></i>
        </button>
      </div>
    </div>
    
  <!-- 工具栏区域 - 移至标题下方 -->
  <div class="bg-gray-800 text-white py-2 sticky-header" style="top: 60px;">
    <div class="container mx-auto px-4">
      <div class="flex space-x-4">
        <button id="dataAnalysisBtn" class="px-4 py-1 rounded bg-primary text-white font-medium">数据分析</button>
        <button id="fiveStarBtn" class="px-4 py-1 rounded bg-gray-600 text-white font-medium hover:bg-primary transition-colors">五星做号</button>
        <button id="goldenRatioBtn" class="px-4 py-1 rounded bg-gray-600 text-white font-medium hover:bg-primary transition-colors">黄金切割</button>
      </div>
    </div>
  </div>
  </header>

  <!-- 主要内容 -->
  <main class="flex-1 container mx-auto px-4 py-6">
    <!-- 数据分析页面 -->
    <div id="dataAnalysisPage">
      <!-- 数据输入区域 -->
      <section class="bg-white rounded-lg shadow-md p-5 mb-6">
        <div class="flex flex-col md:flex-row md:items-center gap-4">
          <div class="flex-1">
            <label for="numbersInput" class="block text-sm font-medium text-gray-700 mb-1">手动输入数据（支持格式：期数 数据，如：202504181232 02,05,01,04,07,10,09,03,06,08 ）</label>
            <textarea id="numbersInput" rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all duration-200" placeholder="202504181232 02,05,01,04,07,10,09,03,06,08"></textarea>
          </div>
          <div class="flex flex-col gap-3 w-full md:w-auto">
            <button id="calcBtn" class="px-4 py-2 bg-primary text-white rounded-md flex items-center justify-center btn-hover">
              <i class="fa fa-calculator mr-2"></i>计算分析
            </button>
            <button id="autoFetchBtn" class="px-4 py-2 bg-secondary text-white rounded-md flex items-center justify-center btn-hover">
              <i class="fa fa-refresh mr-2"></i>自动获取数据
            </button>
            <button id="uploadDataBtn" class="px-4 py-2 bg-gray-600 text-white rounded-md flex items-center justify-center btn-hover">
              <i class="fa fa-upload mr-2"></i>上传数据文件
            </button>
          </div>
        </div>
        <div id="output" class="mt-3 text-sm text-primary"></div>
      </section>

      <!-- 筛选和统计控制区域 -->
      <section class="bg-white rounded-lg shadow-md p-5 mb-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <!-- 胆码数筛选 -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">胆码数筛选：</label>
            <div id="numButtons" class="flex flex-wrap gap-2"></div>
          </div>
          
          <!-- 中出筛选 -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">中出筛选：</label>
            <div id="hitButtons" class="flex flex-wrap gap-2"></div>
          </div>
          
          <!-- 自定义组合 -->
          <div class="md:col-span-2">
            <label for="customCombos" class="block text-sm font-medium text-gray-700 mb-1">自定义组合（用空格分隔不同组合，每个组合内的数字用逗号分隔）：</label>
            <textarea id="customCombos" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all duration-200" placeholder="1,2,3 1,2,4"></textarea>
          </div>
        </div>
        
        <!-- 操作按钮 -->
        <div class="flex flex-wrap gap-3 mt-5">
          <button id="sortToggle" class="px-4 py-2 bg-gray-700 text-white rounded-md flex items-center btn-hover">
            <i class="fa fa-sort mr-2"></i><span id="sortText">按连中次数排序</span>
          </button>
          <button id="statBtn" class="px-4 py-2 bg-gray-700 text-white rounded-md flex items-center btn-hover">
            <i class="fa fa-bar-chart mr-2"></i>更新统计
          </button>
          <button id="exportBtn" class="px-4 py-2 bg-gray-700 text-white rounded-md flex items-center btn-hover">
            <i class="fa fa-download mr-2"></i>导出数据
          </button>
          <button id="clearBtn" class="px-4 py-2 bg-gray-700 text-white rounded-md flex items-center btn-hover">
            <i class="fa fa-trash mr-2"></i>清空数据
          </button>
        </div>
        
        <!-- 统计摘要 -->
        <div id="summary" class="mt-4 p-3 bg-gray-50 rounded-md text-sm font-medium"></div>
      </section>

      <!-- 结果表格 -->
      <section class="bg-white rounded-lg shadow-md p-5 overflow-x-auto relative">
        <div class="flex flex-wrap justify-between items-center mb-4 gap-3">
          <div class="flex items-center gap-3">
            <h2 class="text-lg font-semibold">数据分析结果</h2>
            <!-- 统一的按钮组 -->
            <div class="flex gap-1">
              <!-- 当前/历史切换 -->
              <div class="flex rounded-md overflow-hidden border border-gray-300">
                <button id="currentBtn" class="px-3 py-1 bg-gray-200 text-gray-700 btn-hover text-sm">历史</button>
                <button id="historyBtn" class="px-3 py-1 bg-blue-600 text-white btn-hover text-sm btn-active">当前</button>
              </div>
              <!-- 遗漏/连中切换 -->
              <div class="flex rounded-md overflow-hidden border border-gray-300">
                <button id="missBtn" class="px-3 py-1 bg-blue-600 text-white btn-hover text-sm btn-active">遗漏</button>
                <button id="hitBtn" class="px-3 py-1 bg-gray-200 text-gray-700 btn-hover text-sm">连中</button>
              </div>
            </div>
          </div>
          <div class="flex flex-wrap gap-2">
            <button class="period-btn px-3 py-1 rounded-md bg-gray-200 btn-hover btn-active" data-period="30">30期</button>
            <button class="period-btn px-3 py-1 rounded-md bg-gray-200 btn-hover" data-period="50">50期</button>
            <button class="period-btn px-3 py-1 rounded-md bg-gray-200 btn-hover" data-period="100">100期</button>
            <div class="flex items-center gap-1">
              <input type="number" id="customPeriod" min="1" max="10000" value="30" class="w-16 px-2 py-1 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
              <button id="customPeriodBtn" class="px-3 py-1 rounded-md bg-gray-200 btn-hover">自定义</button>
            </div>
          </div>
          <div class="text-sm text-gray-500">
            <span id="periodCount">0</span> 期数据
          </div>
        </div>
        
        <!-- 水平滑块 -->
        <div class="slider-container">
          <div class="slider-track"></div>
          <div class="slider-fill" id="horizontalFill"></div>
          <div class="slider-thumb" id="horizontalThumb"></div>
        </div>
        
        <div class="relative">
          <div class="overflow-x-auto scrollbar-hide" id="tableContainer">
            <table id="resultTable" class="min-w-full divide-y divide-gray-200">
              <thead></thead>
              <tbody></tbody>
            </table>
          </div>
          
          <!-- 垂直滑块 -->
          <div class="vertical-slider-container" id="verticalSlider">
            <div class="vertical-slider-track"></div>
            <div class="vertical-slider-fill" id="verticalFill"></div>
            <div class="vertical-slider-thumb" id="verticalThumb"></div>
          </div>
        </div>
      </section>
    </div>
    
    <!-- 五星做号页面（按图片布局） -->
    <div id="fiveStarPage" class="hidden">
      <div class="container mx-auto py-8">
        <div class="bg-white rounded-lg shadow-md p-6">
           <!-- 下方添加区域 - 所有模块统一容器 -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="modules-container">
            <!-- 左侧卡片 - 模块1 (5组筛选条件) -->
        <div id="module1" class="border border-gray-200 rounded-lg p-4 five-star-module">
          <!-- 模块级共享容错选择器 -->
          <div class="flex items-center mb-2 pb-4 border-b">
            <span class="text-gray-600 mr-2">模块容错</span>
            <select class="tolerance-min border border-gray-300 rounded px-2 py-1 text-sm" data-module="1">
              <option>0</option>
            </select>
            <span class="mx-2">至</span>
            <select class="tolerance-max border border-gray-300 rounded px-2 py-1 text-sm" data-module="1">
              <option>0</option>
            </select>
          </div>
          
          <!-- 第1组筛选条件 -->
          <div class="filter-group mb-2 pb-0 border-b">
            <div class="flex flex-wrap gap-2 mb-2 number-buttons">
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="1" data-module="1" data-group="1">01</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="2" data-module="1" data-group="1">02</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="3" data-module="1" data-group="1">03</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="4" data-module="1" data-group="1">04</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="5" data-module="1" data-group="1">05</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="6" data-module="1" data-group="1">06</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="7" data-module="1" data-group="1">07</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="8" data-module="1" data-group="1">08</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="9" data-module="1" data-group="1">09</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="10" data-module="1" data-group="1">10</button>
            </div>
            
            <div class="flex flex-wrap gap-2 mb-2 dama-buttons">
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="0" data-module="1" data-group="1">0胆</button>
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="1" data-module="1" data-group="1">1胆</button>
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="2" data-module="1" data-group="1">2胆</button>
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="3" data-module="1" data-group="1">3胆</button>
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="4" data-module="1" data-group="1">4胆</button>
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="5" data-module="1" data-group="1">5胆</button>
            </div>
          </div>
          
          <!-- 第2组筛选条件 -->
          <div class="filter-group mb-2 pb-0 border-b">
            <div class="flex flex-wrap gap-2 mb-2 number-buttons">
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="1" data-module="1" data-group="2">01</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="2" data-module="1" data-group="2">02</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="3" data-module="1" data-group="2">03</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="4" data-module="1" data-group="2">04</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="5" data-module="1" data-group="2">05</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="6" data-module="1" data-group="2">06</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="7" data-module="1" data-group="2">07</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="8" data-module="1" data-group="2">08</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="9" data-module="1" data-group="2">09</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="10" data-module="1" data-group="2">10</button>
            </div>
            
            <div class="flex flex-wrap gap-2 mb-2 dama-buttons">
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="0" data-module="1" data-group="2">0胆</button>
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="1" data-module="1" data-group="2">1胆</button>
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="2" data-module="1" data-group="2">2胆</button>
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="3" data-module="1" data-group="2">3胆</button>
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="4" data-module="1" data-group="2">4胆</button>
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="5" data-module="1" data-group="2">5胆</button>
            </div>
          </div>
          
          <!-- 第3组筛选条件 -->
          <div class="filter-group mb-2 pb-0 border-b">
            <div class="flex flex-wrap gap-2 mb-2 number-buttons">
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="1" data-module="1" data-group="3">01</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="2" data-module="1" data-group="3">02</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="3" data-module="1" data-group="3">03</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="4" data-module="1" data-group="3">04</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="5" data-module="1" data-group="3">05</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="6" data-module="1" data-group="3">06</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="7" data-module="1" data-group="3">07</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="8" data-module="1" data-group="3">08</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="9" data-module="1" data-group="3">09</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="10" data-module="1" data-group="3">10</button>
            </div>
            
            <div class="flex flex-wrap gap-2 mb-2 dama-buttons">
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="0" data-module="1" data-group="3">0胆</button>
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="1" data-module="1" data-group="3">1胆</button>
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="2" data-module="1" data-group="3">2胆</button>
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="3" data-module="1" data-group="3">3胆</button>
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="4" data-module="1" data-group="3">4胆</button>
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="5" data-module="1" data-group="3">5胆</button>
            </div>
          </div>
          
          <!-- 第4组筛选条件 -->
          <div class="filter-group mb-2 pb-0 border-b">
            <div class="flex flex-wrap gap-2 mb-2 number-buttons">
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="1" data-module="1" data-group="4">01</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="2" data-module="1" data-group="4">02</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="3" data-module="1" data-group="4">03</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="4" data-module="1" data-group="4">04</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="5" data-module="1" data-group="4">05</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="6" data-module="1" data-group="4">06</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="7" data-module="1" data-group="4">07</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="8" data-module="1" data-group="4">08</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="9" data-module="1" data-group="4">09</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="10" data-module="1" data-group="4">10</button>
            </div>
            
            <div class="flex flex-wrap gap-2 mb-2 dama-buttons">
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="0" data-module="1" data-group="4">0胆</button>
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="1" data-module="1" data-group="4">1胆</button>
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="2" data-module="1" data-group="4">2胆</button>
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="3" data-module="1" data-group="4">3胆</button>
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="4" data-module="1" data-group="4">4胆</button>
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="5" data-module="1" data-group="4">5胆</button>
            </div>
          </div>
          
          <!-- 第5组筛选条件 -->
          <div class="filter-group mb-2 pb-0">
            <div class="flex flex-wrap gap-2 mb-2 number-buttons">
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="1" data-module="1" data-group="5">01</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="2" data-module="1" data-group="5">02</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="3" data-module="1" data-group="5">03</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="4" data-module="1" data-group="5">04</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="5" data-module="1" data-group="5">05</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="6" data-module="1" data-group="5">06</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="7" data-module="1" data-group="5">07</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="8" data-module="1" data-group="5">08</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="9" data-module="1" data-group="5">09</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="10" data-module="1" data-group="5">10</button>
            </div>
            
            <div class="flex flex-wrap gap-2 mb-0 dama-buttons">
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="0" data-module="1" data-group="5">0胆</button>
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="1" data-module="1" data-group="5">1胆</button>
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="2" data-module="1" data-group="5">2胆</button>
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="3" data-module="1" data-group="5">3胆</button>
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="4" data-module="1" data-group="5">4胆</button>
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="5" data-module="1" data-group="5">5胆</button>
            </div>
          </div>
          
          <!-- 输入区域 -->
          <div class="flex mb-2">
            <input type="text" placeholder="输入结果" class="result-input flex-1 border border-gray-300 rounded-l px-3 py-2 text-sm focus:outline-none focus:ring-1 focus:ring-primary" data-module="1">
            <button class="clear-btn px-3 border border-gray-300 border-l-0 bg-gray-100 hover:bg-gray-200 text-sm" data-module="1">清</button>
            <button class="reverse-btn px-3 border border-gray-300 border-l-0 bg-gray-100 hover:bg-gray-200 text-sm rounded-r" data-module="1">反</button>
          </div>
          <div class="text-red-500 text-sm mb-4 result-count" data-module="1">共0注</div>
          
          <!-- 操作按钮区域 -->
          <div class="flex gap-2">
            <button class="generate-btn flex-1 bg-blue-600 text-white py-2 rounded hover:bg-blue-700" data-module="1">做号</button>
            <button class="copy-btn flex-1 bg-blue-600 text-white py-2 rounded hover:bg-blue-700" data-module="1">复制</button>
            <button onclick="addModule(1)" class="add-btn w-10 bg-green-600 text-white py-2 rounded hover:bg-green-700" data-module="1">+</button>
            <button onclick="removeModule(1)" class="remove-btn w-10 bg-red-600 text-white py-2 rounded hover:bg-red-700" data-module="1">-</button>
          </div>
        </div>
            
            <!-- 右侧卡片 - 模块2 (结构与模块1相同，data-module="2") -->
        <div id="module2" class="border border-gray-200 rounded-lg p-4 five-star-module">
          <!-- 模块级共享容错选择器 -->
          <div class="flex items-center mb-2 pb-4 border-b">
            <span class="text-gray-600 mr-2">模块容错</span>
            <select class="tolerance-min border border-gray-300 rounded px-2 py-1 text-sm" data-module="2">
              <option>0</option>
            </select>
            <span class="mx-2">至</span>
            <select class="tolerance-max border border-gray-300 rounded px-2 py-1 text-sm" data-module="2">
              <option>0</option>
            </select>
          </div>
          
          <!-- 第1组筛选条件 -->
          <div class="filter-group mb-2 pb-2 border-b">
            <div class="flex flex-wrap gap-2 mb-2 number-buttons">
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="1" data-module="2" data-group="1">01</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="2" data-module="2" data-group="1">02</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="3" data-module="2" data-group="1">03</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="4" data-module="2" data-group="1">04</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="5" data-module="2" data-group="1">05</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="6" data-module="2" data-group="1">06</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="7" data-module="2" data-group="1">07</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="8" data-module="2" data-group="1">08</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="9" data-module="2" data-group="1">09</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="10" data-module="2" data-group="1">10</button>
            </div>
            
            <div class="flex flex-wrap gap-2 mb-0 dama-buttons">
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="0" data-module="2" data-group="1">0胆</button>
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="1" data-module="2" data-group="1">1胆</button>
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="2" data-module="2" data-group="1">2胆</button>
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="3" data-module="2" data-group="1">3胆</button>
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="4" data-module="2" data-group="1">4胆</button>
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="5" data-module="2" data-group="1">5胆</button>
            </div>
          </div>
          
          <!-- 第2组筛选条件 -->
          <div class="filter-group mb-2 pb-2 border-b">
            <div class="flex flex-wrap gap-2 mb-2 number-buttons">
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="1" data-module="2" data-group="2">01</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="2" data-module="2" data-group="2">02</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="3" data-module="2" data-group="2">03</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="4" data-module="2" data-group="2">04</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="5" data-module="2" data-group="2">05</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="6" data-module="2" data-group="2">06</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="7" data-module="2" data-group="2">07</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="8" data-module="2" data-group="2">08</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="9" data-module="2" data-group="2">09</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="10" data-module="2" data-group="2">10</button>
            </div>
            
            <div class="flex flex-wrap gap-2 mb-0 dama-buttons">
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="0" data-module="2" data-group="2">0胆</button>
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="1" data-module="2" data-group="2">1胆</button>
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="2" data-module="2" data-group="2">2胆</button>
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="3" data-module="2" data-group="2">3胆</button>
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="4" data-module="2" data-group="2">4胆</button>
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="5" data-module="2" data-group="2">5胆</button>
            </div>
          </div>
          
          <!-- 第3组筛选条件 -->
          <div class="filter-group mb-2 pb-2 border-b">
            <div class="flex flex-wrap gap-2 mb-2 number-buttons">
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="1" data-module="2" data-group="3">01</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="2" data-module="2" data-group="3">02</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="3" data-module="2" data-group="3">03</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="4" data-module="2" data-group="3">04</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="5" data-module="2" data-group="3">05</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="6" data-module="2" data-group="3">06</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="7" data-module="2" data-group="3">07</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="8" data-module="2" data-group="3">08</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="9" data-module="2" data-group="3">09</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="10" data-module="2" data-group="3">10</button>
            </div>
            
            <div class="flex flex-wrap gap-2 mb-0 dama-buttons">
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="0" data-module="2" data-group="3">0胆</button>
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="1" data-module="2" data-group="3">1胆</button>
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="2" data-module="2" data-group="3">2胆</button>
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="3" data-module="2" data-group="3">3胆</button>
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="4" data-module="2" data-group="3">4胆</button>
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="5" data-module="2" data-group="3">5胆</button>
            </div>
          </div>
          
          <!-- 第4组筛选条件 -->
          <div class="filter-group mb-2 pb-2 border-b">
            <div class="flex flex-wrap gap-2 mb-2 number-buttons">
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="1" data-module="2" data-group="4">01</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="2" data-module="2" data-group="4">02</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="3" data-module="2" data-group="4">03</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="4" data-module="2" data-group="4">04</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="5" data-module="2" data-group="4">05</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="6" data-module="2" data-group="4">06</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="7" data-module="2" data-group="4">07</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="8" data-module="2" data-group="4">08</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="9" data-module="2" data-group="4">09</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="10" data-module="2" data-group="4">10</button>
            </div>
            
            <div class="flex flex-wrap gap-2 mb-0 dama-buttons">
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="0" data-module="2" data-group="4">0胆</button>
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="1" data-module="2" data-group="4">1胆</button>
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="2" data-module="2" data-group="4">2胆</button>
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="3" data-module="2" data-group="4">3胆</button>
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="4" data-module="2" data-group="4">4胆</button>
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="5" data-module="2" data-group="4">5胆</button>
            </div>
          </div>
          
          <!-- 第5组筛选条件 -->
          <div class="filter-group mb-2 pb-0">
            <div class="flex flex-wrap gap-2 mb-2 number-buttons">
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="1" data-module="2" data-group="5">01</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="2" data-module="2" data-group="5">02</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="3" data-module="2" data-group="5">03</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="4" data-module="2" data-group="5">04</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="5" data-module="2" data-group="5">05</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="6" data-module="2" data-group="5">06</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="7" data-module="2" data-group="5">07</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="8" data-module="2" data-group="5">08</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="9" data-module="2" data-group="5">09</button>
              <button class="number-btn w-10 h-10 border border-gray-300 rounded flex items-center justify-center text-sm" data-number="10" data-module="2" data-group="5">10</button>
            </div>
            
            <div class="flex flex-wrap gap-2 mb-0 dama-buttons">
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="0" data-module="2" data-group="5">0胆</button>
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="1" data-module="2" data-group="5">1胆</button>
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="2" data-module="2" data-group="5">2胆</button>
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="3" data-module="2" data-group="5">3胆</button>
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="4" data-module="2" data-group="5">4胆</button>
              <button class="dama-btn px-3 py-1 border border-gray-300 rounded text-sm" data-dama="5" data-module="2" data-group="5">5胆</button>
            </div>
          </div>
          
          <!-- module2 输入区域和操作按钮区域与module1相同 -->
          <div class="flex mb-2">
            <input type="text" placeholder="输入结果" class="result-input flex-1 border border-gray-300 rounded-l px-3 py-2 text-sm focus:outline-none focus:ring-1 focus:ring-primary" data-module="2">
            <button class="clear-btn px-3 border border-gray-300 border-l-0 bg-gray-100 hover:bg-gray-200 text-sm" data-module="2">清</button>
            <button class="reverse-btn px-3 border border-gray-300 border-l-0 bg-gray-100 hover:bg-gray-200 text-sm rounded-r" data-module="2">反</button>
          </div>
          <div class="text-red-500 text-sm mb-4 result-count" data-module="2">共0注</div>
          
          <div class="flex gap-2">
            <button class="generate-btn flex-1 bg-blue-600 text-white py-2 rounded hover:bg-blue-700" data-module="2">做号</button>
            <button class="copy-btn flex-1 bg-blue-600 text-white py-2 rounded hover:bg-blue-700" data-module="2">复制</button>
            <button onclick="addModule(2)" class="add-btn w-10 bg-green-600 text-white py-2 rounded hover:bg-green-700" data-module="2">+</button>
            <button onclick="removeModule(2)" class="remove-btn w-10 bg-red-600 text-white py-2 rounded hover:bg-red-700" data-module="2">-</button>
          </div>
        </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 黄金分割页面 -->
    <div id="goldenRatioPage" class="hidden">
      <div class="container mx-auto px-4 py-6">
        <div class="bg-white rounded-lg shadow-lg p-6">
          <h2 class="text-2xl font-bold text-gray-800 mb-6">黄金切割分析</h2>
          
          <!-- 输入区域 -->
          <div class="mb-6">
            <label for="goldenInputData" class="block text-sm font-medium text-gray-700 mb-2">请输入数据 <span id="goldenInputCount" class="text-red-500 text-sm font-medium hidden">共 0 项</span></label>
            <textarea 
              id="goldenInputData" 
              rows="6" 
              placeholder="示例：01,02,03,04,05,06,07,08,09,10" 
              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent resize-none overflow-auto whitespace-pre-wrap"
            ></textarea>
          </div>
          

          
          <!-- 操作按钮 -->
          <div class="flex justify-center gap-3 mb-6">
            <button 
              id="goldenSplitBtn" 
              class="px-6 py-2 bg-primary text-white font-medium rounded-md hover:bg-primary/80 transition-colors"
            >开始分割</button>
            <button 
              id="goldenPasteBtn" 
              class="px-6 py-2 bg-green-500 text-white font-medium rounded-md hover:bg-green-600 transition-colors"
            >粘贴数据</button>
            <button 
              id="goldenClearBtn" 
              class="px-6 py-2 bg-gray-500 text-white font-medium rounded-md hover:bg-gray-600 transition-colors"
            >清空</button>
          </div>
          
          <!-- 结果显示区域 -->
          <div class="mb-6">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-lg font-semibold text-gray-800">分割结果</h3>
              <div class="text-sm text-gray-500" id="resultSummary"></div>
            </div>
            
            <!-- 5个紧凑排列的框 -->
            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-2">
              <div id="goldenResults" class="col-span-full grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-2">
                <!-- 5个分组结果将在这里动态生成 -->
              </div>
            </div>
          </div>
          
          <!-- 验证结果显示 -->
          <div id="validationResults" class="mt-6 p-4 bg-gray-50 rounded-md hidden">
            <h3 class="text-lg font-semibold mb-2">5in4验证结果</h3>
            <div id="validationContent"></div>
          </div>
        </div>
      </div>
    </div>


  </main>
  
  

  <!-- 页脚 -->
  <footer class="bg-white border-t border-gray-200 py-4">
    <div class="container mx-auto px-4 text-center text-gray-500 text-sm">
      <p>台湾PK数据分析工具 © 2025</p>
    </div>
  </footer>

  <!-- 帮助模态框 -->
  <div id="helpModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
      <div class="p-5 border-b border-gray-200 flex justify-between items-center">
        <h3 class="text-xl font-semibold">使用帮助</h3>
        <button id="closeHelpBtn" class="text-gray-400 hover:text-gray-600">
          <i class="fa fa-times text-xl"></i>
        </button>
      </div>
      <div class="p-5">
        <h4 class="font-medium text-lg mb-2">功能介绍</h4>
        <p class="mb-4">台湾PK数据分析工具可以帮助您分析和预测台湾PK的开奖结果，通过统计历史数据和组合的命中情况，为您提供参考依据。</p>
        
        <h4 class="font-medium text-lg mb-2">使用方法</h4>
        <ol class="list-decimal list-inside space-y-2 mb-4">
          <li>您可以手动输入数据或使用自动获取功能获取最新的开奖结果</li>
          <li>选择胆码数和中出条件来筛选感兴趣的组合</li>
          <li>您也可以添加自定义组合进行分析</li>
          <li>使用排序功能可以按照连中次数或遗漏次数对组合进行排序</li>
          <li>表格中的"连"表示历史最大连中次数，"漏"表示历史最大遗漏次数</li>
          <li>您可以通过表格上方的期数按钮选择显示最新的30期、50期或100期数据</li>
          <li>使用表格上方的水平滑块可以左右滚动表格内容</li>
          <li>使用表格右侧的垂直滑块可以上下滚动表格内容</li>
        </ol>
        
        <h4 class="font-medium text-lg mb-2">数据格式</h4>
        <p class="mb-4">手动输入数据时，请按照"期数 数据"的格式，例如：202504181232 02,05,01,04,07,10,09,03,06,08 </p>
        
        <h4 class="font-medium text-lg mb-2">快捷键</h4>
        <ul class="list-disc list-inside space-y-1">
          <li>在输入框中按下Enter键可快速计算</li>
          <li>使用Ctrl+S可保存当前数据</li>
        </ul>
      </div>
      <div class="p-5 border-t border-gray-200 flex justify-end">
        <button id="gotItBtn" class="px-4 py-2 bg-primary text-white rounded-md btn-hover">我知道了</button>
      </div>
    </div>
  </div>

  <!-- 密钥验证模态框 -->
  <div id="keyModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center" style="z-index: 9999;">
    <div class="bg-white rounded-lg shadow-xl w-full max-w-md p-6">
      <div class="text-center mb-6">
        <h3 class="text-2xl font-bold text-gray-800 mb-2">请输入访问密钥</h3>
        <p class="text-gray-600">该功能需要有效的访问密钥才能使用</p>
      </div>
      
      <div class="mb-4">
        <input type="text" id="keyInput" placeholder="请输入32位访问密钥" class="w-full px-4 py-3 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all duration-200">
      </div>
      
      <div class="flex gap-3">
        <button id="verifyKeyBtn" class="w-full px-4 py-3 bg-primary text-white rounded-md font-medium hover:bg-primary/80 transition-colors">验证密钥</button>
        <!-- 移除取消按钮 -->
      </div>
    </div>
  </div>

  

<script>
// 全局模块状态存储
window.moduleStates = {};

// 添加模块功能
function addModule(currentModuleId) {
  const modulesContainer = document.getElementById('modules-container');
  const moduleElements = modulesContainer.querySelectorAll('.five-star-module');

  // 检查模块数量上限（最多14个）
  if (moduleElements.length >= 14) {
    alert('最多只能添加14个模块');
    return;
  }

  // 获取最后一个模块ID并递增
  const lastModuleId = parseInt(moduleElements[moduleElements.length - 1].id.replace('module', ''));
  const newModuleId = lastModuleId + 1;

  // 克隆当前模块
  const currentModule = document.getElementById(`module${currentModuleId}`);
  const newModule = currentModule.cloneNode(true);
  newModule.id = `module${newModuleId}`;
  newModule.querySelectorAll('[data-module]').forEach(el => {
    el.dataset.module = newModuleId;
  });
  resetModuleState(newModule);

  // 克隆当前模块后添加以下代码
  const newAddBtn = newModule.querySelector('.add-btn');
  newAddBtn.setAttribute('onclick', `addModule(${newModuleId})`);

  const newRemoveBtn = newModule.querySelector('.remove-btn');
  newRemoveBtn.setAttribute('onclick', `removeModule(${newModuleId})`);

  // 直接添加到模块容器末尾
  modulesContainer.appendChild(newModule);

  // 初始化新模块
  initFiveStarModule(newModuleId);
}

// 移除单个模块 - 确保最少保留2个
function removeModule(moduleId) {
  const modulesContainer = document.getElementById('modules-container');
  const moduleElements = modulesContainer.querySelectorAll('.five-star-module');
  const moduleToRemove = document.getElementById(`module${moduleId}`);

  // 确保至少保留2个模块
  if (moduleElements.length <= 2) {
    alert('至少保留2个模块');
    return;
  }

  // 移除模块
  moduleToRemove.remove();
}

// 重置模块状态的辅助函数
function resetModuleState(module) {
  // 清除克隆模块的选中状态和结果
  module.querySelectorAll('.number-btn, .dama-btn').forEach(btn => {
    btn.classList.remove('bg-primary', 'text-white');
  });
  module.querySelector('.result-input').value = '';
  module.querySelector('.result-count').textContent = '共0注';
}

// 生成排列组合的函数 - 迭代版本避免栈溢出
function permute(arr, k) {
  if (k === 0) return [[]];
  if (k === 1) return arr.map(x => [x]);
  
  const result = [];
  const stack = [{ current: [], remaining: arr, depth: 0 }];
  
  while (stack.length > 0) {
    const { current, remaining, depth } = stack.pop();
    
    if (depth === k) {
      result.push([...current]);
      continue;
    }
    
    for (let i = 0; i < remaining.length; i++) {
      const newCurrent = [...current, remaining[i]];
      const newRemaining = remaining.slice(0, i).concat(remaining.slice(i + 1));
      stack.push({ current: newCurrent, remaining: newRemaining, depth: depth + 1 });
    }
  }
  
  return result;
}

// 初始化五星模块
function initFiveStarModule(moduleId) {
  // 模块状态存储 - 修改为按组存储条件
  const moduleState = window.moduleStates[moduleId] = {
    groups: [
        { selectedNumbers: [], selectedDamas: [] }, // 组1
        { selectedNumbers: [], selectedDamas: [] }, // 组2
        { selectedNumbers: [], selectedDamas: [] }, // 组3
        { selectedNumbers: [], selectedDamas: [] }, // 组4
        { selectedNumbers: [], selectedDamas: [] }  // 组5
    ],
    results: [],         // 当前显示结果
    allPermutations: [], // 所有排列组合
    originalResults: [], // 原始筛选结果
    isReversed: false    // 是否显示反向结果
  };

  // 获取模块元素
  const module = document.getElementById(`module${moduleId}`);
  const numberButtons = module.querySelectorAll('.number-btn');
  const damaButtons = module.querySelectorAll('.dama-btn');
  const generateBtn = module.querySelector('.generate-btn');
  const copyBtn = module.querySelector('.copy-btn');
  const clearBtn = module.querySelector('.clear-btn');
  const reverseBtn = module.querySelector('.reverse-btn');
  const resultInput = module.querySelector('.result-input');
  const resultCount = module.querySelector('.result-count');
  const toleranceMinSelect = module.querySelector('.tolerance-min');
  const toleranceMaxSelect = module.querySelector('.tolerance-max');

  // 数字按钮点击事件
  numberButtons.forEach(button => {
      button.addEventListener('click', function() {
          const number = parseInt(this.dataset.number);
          const groupIndex = parseInt(this.dataset.group) - 1;
          const groupState = moduleState.groups[groupIndex];
          const index = groupState.selectedNumbers.indexOf(number);
          
          if (index === -1) {
              groupState.selectedNumbers.push(number);
              this.classList.add('bg-primary', 'text-white');
          } else {
              groupState.selectedNumbers.splice(index, 1);
              this.classList.remove('bg-primary', 'text-white');
          }
      });
  });

  // 胆码按钮点击事件
  damaButtons.forEach(button => {
      button.addEventListener('click', function() {
          const dama = parseInt(this.dataset.dama);
          const groupIndex = parseInt(this.dataset.group) - 1;
          const groupState = moduleState.groups[groupIndex];
          const index = groupState.selectedDamas.indexOf(dama);
          
          if (index === -1) {
              groupState.selectedDamas.push(dama);
              this.classList.add('bg-primary', 'text-white');
          } else {
              groupState.selectedDamas.splice(index, 1);
              this.classList.remove('bg-primary', 'text-white');
          }
      });
  });

  // 容错选择事件
  toleranceMinSelect.addEventListener('change', function() {
    moduleState.toleranceMin = parseInt(this.value);
  });

  toleranceMaxSelect.addEventListener('change', function() {
    moduleState.toleranceMax = parseInt(this.value);
  });

  // 做号按钮点击事件
  generateBtn.addEventListener('click', function() {
    // 生成所有可能的5个数字的排列 (从1-10中选择)
    const allNumbers = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];
    const permutations = permute(allNumbers, 5);
    
    // 存储所有排列组合
    moduleState.allPermutations = permutations;
    
    // 根据选中的数字和胆码筛选结果
    // 筛选满足所有组条件的组合
    const filteredResults = permutations.filter(comb => {
        // 检查是否满足所有组的条件
        return moduleState.groups.every(group => {
            // 空条件组直接通过
            if (group.selectedNumbers.length === 0 && group.selectedDamas.length === 0) {
                return true;
            }

            // 计算组合与当前组选中数字的交集
            const intersection = comb.filter(num => group.selectedNumbers.includes(num));
            const matchCount = intersection.length;

            // 新逻辑：根据胆码选择情况应用不同规则
            if (group.selectedDamas.length === 0) {
                // 未选择胆码：匹配任意数量的选中数字(至少1个)
                return matchCount > 0;
            } else {
                // 已选择胆码：必须精确匹配胆码数量
                return group.selectedDamas.some(dama => matchCount === dama);
            }
        });
    });
    
    // 首次生成时就按照格式化逻辑处理并存储为字符串
    const formattedResults = filteredResults.map(comb => 
        comb.map(num => num.toString().padStart(2, '0')).join(' ')
    );
    

    
    moduleState.results = formattedResults;
    moduleState.originalResults = [...formattedResults]; // 保存原始结果
    moduleState.isReversed = false;
    
    updateResultDisplay();
  });

  // 复制按钮点击事件
  copyBtn.addEventListener('click', function() {
    if (moduleState.results.length === 0) {
      // 修改无结果提示为文本显示
      resultCount.innerHTML = '<span style="color: red;">没有可复制的结果</span>';
      setTimeout(() => {
        resultCount.textContent = `共${moduleState.results.length}注`;
      }, 2000);
      return;
    }

    // 先全选输入框内容
    resultInput.select();
    resultInput.setSelectionRange(0, 99999); // 兼容移动设备
    
    // 复制存储的筛选结果 - 组内空格，组间逗号
    // moduleState.results中每个元素已经是格式化的字符串（如"01 02 03 04 05"）
    // 直接用逗号连接即可得到正确格式
    let textToCopy = '';
    for (let i = 0; i < moduleState.results.length; i++) {
      if (i > 0) textToCopy += ',';
      textToCopy += moduleState.results[i];
    }

    // 复制到剪贴板
    navigator.clipboard.writeText(textToCopy).then(() => {
      // 复制成功后保持原有显示，不添加额外提示
      resultCount.textContent = `共${moduleState.results.length}注`;
    }).catch(err => {
      console.error('复制失败:', err);
      // 错误提示：显示红色错误文本
      resultCount.innerHTML = '<span style="color: red;">复制失败，请手动复制</span>';
      setTimeout(() => {
        resultCount.textContent = `共${moduleState.results.length}注`;
      }, 2000);
    });
  });

  // 清除按钮点击事件
  clearBtn.addEventListener('click', function() {
    // 修复：按组清除选中状态
    moduleState.groups.forEach(group => {
        group.selectedNumbers = [];
        group.selectedDamas = [];
    });
    moduleState.results = [];
    moduleState.originalResults = [];
    moduleState.isReversed = false;
    
    // 清除所有按钮选中状态
    numberButtons.forEach(btn => btn.classList.remove('bg-primary', 'text-white'));
    damaButtons.forEach(btn => btn.classList.remove('bg-primary', 'text-white'));
    
    // 清除结果显示
    resultInput.value = '';
    resultCount.textContent = '共0注';
  });

  // 反向按钮点击事件 - 修改为显示筛选结果的补集
  reverseBtn.addEventListener('click', function() {
    // 检查是否已生成结果
    if (moduleState.allPermutations.length === 0 || moduleState.originalResults.length === 0) {
      alert('请先点击"做号"生成结果');
      return;
    }

    // 切换反向状态
    if (!moduleState.isReversed) {
      // 生成原始结果的补集（所有组合中排除原始结果）
      // 创建原始结果的字符串表示集合用于快速查找
      const originalSet = new Set(moduleState.originalResults);
      // 筛选出不在原始结果中的所有组合，并格式化
      const complementResults = moduleState.allPermutations
        .filter(comb => {
          const formattedComb = comb.map(num => num.toString().padStart(2, '0')).join(' ');
          return !originalSet.has(formattedComb);
        })
        .map(comb => comb.map(num => num.toString().padStart(2, '0')).join(' '));
      moduleState.results = complementResults;
      moduleState.isReversed = true;
    } else {
      // 恢复显示原始结果
      moduleState.results = moduleState.originalResults;
      moduleState.isReversed = false;
    }

    updateResultDisplay();
  });



  // 更新结果显示 - 版本2024.12.19
  function updateResultDisplay() {
    const totalCount = moduleState.results.length;
    const displayResults = totalCount > 40000 ? moduleState.results.slice(0, 40000) : moduleState.results;
    // 结果已经是格式化的字符串，直接用逗号连接（逗号后不加空格）
    let displayText = '';
    for (let i = 0; i < displayResults.length; i++) {
      if (i > 0) displayText += ',';
      displayText += displayResults[i];
    }
    
    // 立即设置结果
    resultInput.value = totalCount > 40000 ? displayText + '...' : displayText;
    resultCount.textContent = `共${totalCount}注`;
    
    // 延迟再次确保格式正确（防止被其他代码覆盖）
    setTimeout(() => {
      resultInput.value = totalCount > 40000 ? displayText + '...' : displayText;
    }, 10);
    

  }
}

// 页面加载时初始化现有模块
document.addEventListener('DOMContentLoaded', function() {
  // 初始化模块1和模块2
  initFiveStarModule(1);
  initFiveStarModule(2);
});


function t(t){const e={groups:[{selectedNumbers:[],selectedDamas:[]},{selectedNumbers:[],selectedDamas:[]},{selectedNumbers:[],selectedDamas:[]},{selectedNumbers:[],selectedDamas:[]},{selectedNumbers:[],selectedDamas:[]}],results:[],allPermutations:[],originalResults:[],isReversed:!1},n=document.getElementById(`module${t}`),o=n.querySelectorAll(".number-btn"),r=n.querySelectorAll(".dama-btn"),i=n.querySelector(".generate-btn"),a=n.querySelector(".copy-btn"),s=n.querySelector(".clear-btn"),d=n.querySelector(".reverse-btn"),u=n.querySelector(".result-input"),l=n.querySelector(".result-count"),m=n.querySelector(".tolerance-min"),f=n.querySelector(".tolerance-max");function y(){
  let results = e.results;
  // 确保每注是已格式化好的字符串
  if (Array.isArray(results[0])) {
    results = results.map(comb => comb.map(num => num.toString().padStart(2, '0')).join(' '));
    e.results = results;
  }
  const totalCount = results.length;
  const displayResults = results.slice(0, 300); // 只显示前300注
  const displayText = displayResults.join(',');
  u.value = displayText;
  l.textContent = `共${totalCount}注`;
  setTimeout(() => {
    u.value = displayText;
  }, 10);
}o.forEach(t=>{t.addEventListener("click",function(){const t=parseInt(this.dataset.number),n=parseInt(this.dataset.group),o=e.groups[n-1],c=o.selectedNumbers.indexOf(t);-1===c?(o.selectedNumbers.push(t),this.classList.add("bg-primary","text-white")):(o.selectedNumbers.splice(c,1),this.classList.remove("bg-primary","text-white"))})}),r.forEach(t=>{t.addEventListener("click",function(){const t=parseInt(this.dataset.dama),n=parseInt(this.dataset.group),o=e.groups[n-1],c=o.selectedDamas.indexOf(t);-1===c?(o.selectedDamas.push(t),this.classList.add("bg-primary","text-white")):(o.selectedDamas.splice(c,1),this.classList.remove("bg-primary","text-white"))})}),m.addEventListener("change",function(){e.toleranceMin=parseInt(this.value)}),f.addEventListener("change",function(){e.toleranceMax=parseInt(this.value)}),i.addEventListener("click",function(){const t=c([1,2,3,4,5,6,7,8,9,10],5);e.allPermutations=t;const n=t.filter(t=>e.groups.every(e=>{if(0===e.selectedNumbers.length&&0===e.selectedDamas.length)return!0;const n=t.filter(t=>e.selectedNumbers.includes(t)).length;return 0===e.selectedDamas.length?n>0:e.selectedDamas.some(t=>n===t)}));e.results=n,e.originalResults=[...n],y()}),a.addEventListener("click",function(){
  if(0===e.results.length) {
    l.innerHTML='<span style="color: red;">没有可复制的结果</span>';
    setTimeout(()=>{l.textContent=`共${e.results.length}注`},2e3);
    return;
  }
  let results = e.results;
  // 如果不是字符串数组，先格式化
  if (Array.isArray(results[0])) {
    results = results.map(comb => comb.map(num => num.toString().padStart(2, '0')).join(' '));
  }
  const textToCopy = results.join(',');
  navigator.clipboard.writeText(textToCopy).then(()=>{
    const t=l.textContent;
    l.innerHTML=`${t} <span style=\"color: red;\">已复制 ${results.length} 组号码</span>`;
    setTimeout(()=>{l.textContent=t},2e3)
  }).catch(t=>{
    console.error("复制失败:",t);
    l.innerHTML='<span style="color: red;">复制失败，请手动复制</span>';
    setTimeout(()=>{l.textContent=`共${results.length}注`},2e3)
  });
}),s.addEventListener("click",function(){e.groups.forEach(t=>{t.selectedNumbers=[],t.selectedDamas=[]}),e.results=[],e.originalResults=[],e.isReversed=!1,o.forEach(t=>t.classList.remove("bg-primary","text-white")),r.forEach(t=>t.classList.remove("bg-primary","text-white")),u.value="",l.textContent="共0注"}),d.addEventListener("click",function(){if(0!==e.allPermutations.length&&0!==e.originalResults.length){if(e.isReversed)e.results=e.originalResults,e.isReversed=!1;else{const t=new Set(e.originalResults.map(t=>t.join(","))),n=e.allPermutations.filter(e=>!t.has(e.join(",")));e.results=n,e.isReversed=!0}y()}else alert('请先点击"做号"生成结果')})}function e(e){const n=document.getElementById("modules-container"),c=n.querySelectorAll(".five-star-module");if(c.length>=14)return void alert("最多只能添加14个模块");const r=parseInt(c[c.length-1].id.replace("module",""))+1,i=document.getElementById(`module${e}`).cloneNode(!0);i.id=`module${r}`,i.querySelectorAll("[data-module]").forEach(t=>{t.dataset.module=r}),o(i),i.querySelector(".add-btn").setAttribute("onclick",`addModule(${r})`),i.querySelector(".remove-btn").setAttribute("onclick",`removeModule(${r})`),n.appendChild(i),t(r)}function n(t){const e=document.getElementById("modules-container").querySelectorAll(".five-star-module"),n=document.getElementById(`module${t}`);e.length<=2?alert("至少保留2个模块"):n.remove()}function o(t){t.querySelectorAll(".number-btn, .dama-btn").forEach(t=>{t.classList.remove("bg-primary","text-white")}),t.querySelector(".result-input").value="",t.querySelector(".result-count").textContent="共0注"}function c(t,e){const n=[];return 1===e?t.map(t=>[t]):(t.forEach((t,o,r)=>{const i=c([...r.slice(0,o),...r.slice(o+1)],e-1).map(e=>[t,...e]);n.push(...i)}),n)}tailwind.config={theme:{extend:{colors:{primary:"#d62828",secondary:"#f77f00",neutral:"#f5f5f5",dark:"#333333"},fontFamily:{sans:["Inter","system-ui","sans-serif"]}}}},document.addEventListener("DOMContentLoaded",function(){const t=document.getElementById("dataAnalysisBtn"),e=document.getElementById("fiveStarBtn"),g=document.getElementById("goldenRatioBtn"),n=document.getElementById("dataAnalysisPage"),o=document.getElementById("fiveStarPage"),k=document.getElementById("goldenRatioPage");t&&e&&g&&n&&o&&k?(t.addEventListener("click",function(){n.classList.remove("hidden"),o.classList.add("hidden"),k.classList.add("hidden"),t.classList.add("bg-primary"),t.classList.remove("bg-gray-600"),e.classList.add("bg-gray-600"),e.classList.remove("bg-primary"),g.classList.add("bg-gray-600"),g.classList.remove("bg-primary")}),e.addEventListener("click",function(){n.classList.add("hidden"),o.classList.remove("hidden"),k.classList.add("hidden"),e.classList.add("bg-primary"),e.classList.remove("bg-gray-600"),t.classList.add("bg-gray-600"),t.classList.remove("bg-primary"),g.classList.add("bg-gray-600"),g.classList.remove("bg-primary")}),g.addEventListener("click",function(){n.classList.add("hidden"),o.classList.add("hidden"),k.classList.remove("hidden"),g.classList.add("bg-primary"),g.classList.remove("bg-gray-600"),t.classList.add("bg-gray-600"),t.classList.remove("bg-primary"),e.classList.add("bg-gray-600"),e.classList.remove("bg-primary")})):console.error("页面切换所需元素未找到")}),document.addEventListener("DOMContentLoaded",function(){t(1),t(2);});let r=[],i=1,a=null,s=null,d=new Set,u=null,l=null,m=!1,f=30,y=!1,b=!1,currentPage=1,pageSize=50,totalPages=1;const h="pk4_access_key",g=document.getElementById("keyModal"),p=document.getElementById("keyInput"),v=document.getElementById("output"),x=document.getElementById("tableContainer"),w=document.getElementById("horizontalThumb"),k=document.getElementById("horizontalFill"),$=document.getElementById("verticalSlider"),B=document.getElementById("verticalThumb"),I=document.getElementById("verticalFill"),M=document.getElementById("numButtons");for(let t=1;t<=10;t++){const e=document.createElement("button");e.className="px-3 py-1 rounded-md bg-gray-200 btn-hover",e.dataset.num=t,e.textContent=t,M.appendChild(e)}const S=document.getElementById("hitButtons");function N(t){t.forEach(e=>e.addEventListener("click",()=>{t.forEach(t=>t.classList.remove("btn-active")),e.classList.add("btn-active"),L()}))}function C(t){t.forEach(t=>t.addEventListener("click",()=>{t.classList.toggle("btn-active"),L()}))}[0,1,2,3,4,5].forEach(t=>{const e=document.createElement("button");e.className="px-3 py-1 rounded-md bg-gray-200 btn-hover",e.dataset.hit=t,e.textContent=t+"胆",S.appendChild(e)}),document.querySelector('#numButtons button[data-num="5"]').classList.add("btn-active"),document.querySelector('#hitButtons button[data-hit="2"]').classList.add("btn-active"),N(Array.from(M.children)),C(Array.from(S.children));let T=null;function D(t){const e=document.getElementById("keyCountdown"),n=document.getElementById("timeRemaining");function o(){const o=new Date,c=new Date(1e3*t)-o;if(c<=0){n.textContent="已过期",e.classList.remove("bg-primary","bg-amber-500"),e.classList.add("bg-red-500"),clearInterval(T);const t=Y();return localStorage.removeItem(`validKey_${t}`),localStorage.removeItem(`keyExpiry_${t}`),b=!1,void setTimeout(()=>{window.location.reload()},3e3)}const r=Math.floor(c/864e5),i=Math.floor(c%864e5/36e5),a=Math.floor(c%36e5/6e4),s=Math.floor(c%6e4/1e3);n.textContent=`${r}天 ${i}小时 ${a}分钟 ${s}秒`;const d=24*r+i;d<=24?(e.classList.remove("bg-primary","bg-amber-500"),e.classList.add("bg-red-500")):d<=72?(e.classList.remove("bg-primary","bg-red-500"),e.classList.add("bg-amber-500")):(e.classList.remove("bg-amber-500","bg-red-500"),e.classList.add("bg-primary"))}T&&clearInterval(T),o(),e.classList.remove("hidden"),T=setInterval(o,1e3)}function generateDeviceFingerprint(){
  // 使用固定的通用指纹，允许密钥在任何设备上使用
  // 这样可以确保密钥的跨设备兼容性
    return 'universal_device_2024';
 }

// 记录密钥使用到服务器
async function recordKeyUsage(keyData) {
    try {
        const deviceId = generateDeviceFingerprint();
        const keyRecord = {
            keyId: keyData.nonce,
            deviceId: deviceId,
            usedAt: new Date().toISOString(),
            expiresAt: new Date(keyData.expiry * 1000).toISOString(),
            userAgent: navigator.userAgent
        };
        
        // 记录到Vercel生产环境
        try {
            const response = await fetch(`https://myyz.vercel.app/api/key-records`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'User-Agent': 'TWPK-KeyValidator/1.0'
                },
                body: JSON.stringify(keyRecord)
            });
            
            if (response.ok) {
                const result = await response.json();
                console.log('密钥使用记录已保存到服务器:', result);
                return { success: true, data: result };
            }
        } catch (error) {
            console.warn('API连接失败:', error);
        }
        
        // API失败，使用本地备份
        console.warn('API连接失败，使用本地备份');
        const localRecord = {
            keyId: keyData.nonce,
            deviceInfo: navigator.userAgent,
            usedAt: new Date().toISOString(),
            savedLocally: true
        };
        localStorage.setItem(`keyRecord_${keyData.nonce}`, JSON.stringify(localRecord));
        return { success: false, error: '网络连接失败', localBackup: true };
    } catch (error) {
        console.error('记录密钥使用信息失败:', error);
        return { success: false, error: error.message };
    }
}

async function O(t){try{const e=await fetch(`https://myyz.vercel.app/api/nonce/check/${encodeURIComponent(t)}`,{method:"GET",headers:{"User-Agent":"TWPK-KeyValidator/1.0"}});if(e.ok){const t=await e.json();return console.log("云端验证响应:",t),{used:t.used}}}catch(e){console.warn("API连接失败:",e);}console.warn("API连接失败，使用本地验证");return{used:JSON.parse(localStorage.getItem("usedNonces")||"[]").includes(t)}}async function K(t){try{const e=await fetch(`https://myyz.vercel.app/api/nonce/mark`,{method:"POST",headers:{"Content-Type":"application/json","User-Agent":"TWPK-KeyValidator/1.0"},body:JSON.stringify({nonce:t})});if(e.ok){const t=await e.json();return console.log("nonce已成功记录到云端:",t),{success:!0}}}catch(e){console.warn("API连接失败:",e);}console.warn("API连接失败，使用本地记录");const e=JSON.parse(localStorage.getItem("usedNonces")||"[]");return e.includes(t)||(e.push(t),localStorage.setItem("usedNonces",JSON.stringify(e)),console.log("本地记录nonce:",t)),{success:!0}}const P=document.getElementById("verifyKeyBtn");function E(t){let e;if(t.includes("\t"))e=t.trim().split(/\t+/);else{if(!t.includes(" "))return null;e=t.trim().split(/\s+/)}if(e.length<2)return null;const n=e[0].trim();let o;if(e[1].includes(","))o=e[1].split(",").map(t=>parseInt(t.trim(),10));else{if(!e[1].includes(" "))return null;o=e[1].split(" ").map(t=>parseInt(t.trim(),10))}return 10!==o.length||o.some(isNaN)?null:{period:n,data:o}}async function A(t){try{const e=atob(t),n=decodeURIComponent(escape(e)),o=JSON.parse(n);if(!o.expiry||!o.nonce||!o.deviceFingerprint)return{valid:!1,reason:"密钥缺少必要字段"};const c=(new Date).getTime();if(Math.floor(c/1e3)>o.expiry)return{valid:!1,reason:"密钥已过期"};const r=generateDeviceFingerprint();return o.deviceFingerprint!==r?{valid:!1,reason:"此密钥不可在当前设备使用"}:(await checkKeyOnlineUsage(o.nonce)).used?{valid:!1,reason:"密钥已被使用，每个密钥只能使用一次"}:{valid:!0,data:o}}catch(t){return t instanceof DOMException&&"InvalidCharacterError"===t.name?{valid:!1,reason:"密钥Base64解码失败"}:t instanceof SyntaxError?{valid:!1,reason:"密钥JSON格式无效"}:{valid:!1,reason:"验证过程异常: "+t.message}}}

// 在线检查密钥是否已被使用
async function checkKeyOnlineUsage(nonce) {
    try {
        const response = await fetch(`https://myyz.vercel.app/api/key-records/check/${encodeURIComponent(nonce)}`, {
            method: 'GET',
            headers: {
                'User-Agent': 'TWPK-KeyValidator/1.0'
            }
        });
        
        if (response.ok) {
            const result = await response.json();
            console.log('在线密钥验证响应:', result);
            return { used: result.used };
        }
    } catch (error) {
        console.warn('API连接失败:', error);
    }
    
    console.warn('所有API连接失败，使用本地验证');
    return { used: JSON.parse(localStorage.getItem('usedNonces') || '[]').includes(nonce) };
}

// 标记密钥为已使用（在线）
async function markKeyAsUsedOnline(nonce) {
    try {
        const response = await fetch(`https://myyz.vercel.app/api/key-records/mark-used`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'User-Agent': 'TWPK-KeyValidator/1.0'
            },
            body: JSON.stringify({ nonce: nonce })
        });
        
        if (response.ok) {
            const result = await response.json();
            console.log('密钥已标记为已使用:', result);
            return { success: true };
        }
    } catch (error) {
        console.warn('API连接失败:', error);
    }
    
    console.warn('所有API连接失败，使用本地标记');
    // 本地备用标记
    const usedNonces = JSON.parse(localStorage.getItem('usedNonces') || '[]');
    if (!usedNonces.includes(nonce)) {
        usedNonces.push(nonce);
        localStorage.setItem('usedNonces', JSON.stringify(usedNonces));
        console.log('本地标记nonce:', nonce);
    }
    return { success: true };
}

    // 记录密钥使用信息到后台
    async function recordKeyUsage(keyData) {
      try {
        const response = await fetch('http://localhost:3000/api/key-records', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            keyId: keyData.nonce,
            deviceInfo: navigator.userAgent,
            usedAt: new Date().toISOString(),
            expiryTime: new Date(keyData.expiry * 1000).toISOString(), // 添加密钥的实际有效期
            createdTime: new Date().toISOString()
          })
        });
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const result = await response.json();
        console.log('密钥使用记录已保存:', result);
        return { success: true, data: result };
      } catch (error) {
        console.error('记录密钥使用信息失败:', error);
        // 网络失败时的本地备用方案
        const localRecord = {
          keyId: keyData.nonce,
          deviceInfo: navigator.userAgent,
          usedAt: new Date().toISOString(),
          savedLocally: true
        };
        localStorage.setItem(`keyRecord_${keyData.nonce}`, JSON.stringify(localRecord));
        return { success: false, error: error.message, localBackup: true };
      }
    }

function F(){if(!b)return g.classList.remove("hidden"),void alert("请先验证有效的密钥");const t=document.getElementById("numbersInput").value.trim().split(/\n+/).filter(Boolean);if(!t.length)return void(v.textContent="请输入数据");let e=0;for(const n of t){const t=E(n);if(!t)return void(v.textContent="格式错误：请输入正确的数据格式");const{period:o,data:c}=t,i=c.join(",");d.has(o)||r.length&&r[r.length-1].input===i||(r.push({period:o,data:c,input:i}),d.add(o),e++)}document.getElementById("numbersInput").value="",v.textContent=e>0?`成功添加 ${e} 期数据`:"没有新数据添加",document.getElementById("periodCount").textContent=r.length,r.sort((t,e)=>{const n=t.period.toString();return e.period.toString().localeCompare(n)}),L()}async function J(){if(!b)return g.classList.remove("hidden"),void alert("请先验证有效的密钥");try{v.textContent="正在获取数据...";const t=await fetch("https://api.duoqu.online/data?id=406&limit=1&key=ibjweyjfzt"),e=await t.json();if("success"===e.info&&e.data.length){const t=e.data[0].openNumber.split(",").map(Number),n=e.data[0].period||n++,o=t.join(",");if(d.has(n)||r.length&&r[r.length-1].input===o)return void(v.textContent="已是最新数据");r.push({period:n,data:t,input:o}),d.add(n),document.getElementById("periodCount").textContent=r.length,v.textContent=`成功获取第 ${n} 期数据`,r.sort((t,e)=>{const n=t.period.toString();return e.period.toString().localeCompare(n)}),L()}else v.textContent="获取数据失败："+(e.message||"未知错误")}catch(t){v.textContent=`获取数据错误：${t.message}`}}function R(t,e){if(!b)return g.classList.remove("hidden"),alert("请先验证有效的密钥"),[];const n=[];return function o(c,r){if(r.length!==e)for(let e=c;e<t.length;e++)r.push(t[e]),o(e+1,r),r.pop();else n.push(r.slice())}(0,[]),n}

/** 
 * 将任意注数组切割为 5 组，构建 5中4 容错结构 
 * 每注会被分配到 5组中的 4组 
 * @param {string[]} data 原始注单数组 
 * @returns {string[][]} 返回5组，每组约 0.8*N 注 
 */ 
function splitTo5in4General(data) { 
  const groupCount = 5; 
  const groups = Array.from({ length: groupCount }, () => []); 

  data.forEach(item => { 
    // 随机选择4个不同的组索引 
    const selectedGroups = shuffle([0, 1, 2, 3, 4]).slice(0, 4); 
    selectedGroups.forEach(g => groups[g].push(item)); 
  }); 

  return groups; 

  // 洗牌函数 
  function shuffle(arr) { 
    const result = arr.slice(); 
    for (let i = result.length - 1; i > 0; i--) { 
      const j = Math.floor(Math.random() * (i + 1)); 
      [result[i], result[j]] = [result[j], result[i]]; 
    } 
    return result; 
  } 
}

// 验证任意4组组合后是否为全集
function validate_5in4(groups) {
    if (!groups || groups.length < 4) {
        return {
            valid: false,
            results: {},
            all_valid: false,
            total_data_size: 0
        };
    }
    
    // 获取所有数据的并集
    const all_set = new Set();
    groups.forEach(group => {
        group.forEach(item => all_set.add(item));
    });
    
    const results = {};
    const total_data_size = all_set.size;
    
    // 生成所有4组的组合
    const combinations = [];
    for (let i = 0; i < groups.length; i++) {
        for (let j = i + 1; j < groups.length; j++) {
            for (let k = j + 1; k < groups.length; k++) {
                for (let l = k + 1; l < groups.length; l++) {
                    combinations.push([i, j, k, l]);
                }
            }
        }
    }
    
    // 验证每个4组组合
    combinations.forEach(combo => {
        const merged = new Set();
        combo.forEach(i => {
            groups[i].forEach(item => merged.add(item));
        });
        
        const is_complete = merged.size === total_data_size;
        results[combo.join(',')] = {
            combo: combo,
            size: merged.size,
            is_complete: is_complete,
            coverage: total_data_size > 0 ? (merged.size / total_data_size) : 0
        };
    });
    
    // 检查是否所有组合都完整
    const all_valid = Object.values(results).every(r => r.is_complete);
    
    return {
        valid: all_valid,
        results: results,
        all_valid: all_valid,
        total_data_size: total_data_size,
        combinations_count: combinations.length
    };
}

// 渲染黄金切割结果 - 5个紧凑框布局
function renderGoldenResults(groups) {
    const resultsContainer = document.getElementById('goldenResults');
    const resultSummary = document.getElementById('resultSummary');
    resultsContainer.innerHTML = '';
    
    if (!groups || groups.length === 0) {
        resultsContainer.innerHTML = '<div class="col-span-5 text-center text-gray-500 py-8">暂无分割结果</div>';
        resultSummary.textContent = '';
        return;
    }
    
    // 更新摘要信息
    const totalItems = groups.reduce((sum, group) => sum + group.length, 0);
    resultSummary.textContent = `共${groups.length}组，总计${totalItems}项`;
    
    // 确保显示5个框，不足的用空框填充
    const displayGroups = [...groups];
    while (displayGroups.length < 5) {
        displayGroups.push([]);
    }
    
    // 生成5个紧凑的分组框
    displayGroups.slice(0, 5).forEach((group, index) => {
        const groupDiv = document.createElement('div');
        groupDiv.className = 'bg-white border border-gray-200 rounded-lg p-3';
        
        if (group.length === 0) {
            // 空框
            groupDiv.innerHTML = `
                <div class="text-center text-gray-400 py-4">
                    <div class="text-sm font-medium mb-1">组 ${index + 1}</div>
                    <div class="text-xs">暂无数据</div>
                </div>
            `;
        } else {
            // 有数据的框
            groupDiv.innerHTML = `
                <div class="flex items-center justify-between mb-2">
                    <h4 class="font-semibold text-gray-800 text-sm">组 ${index + 1}</h4>
                    <div class="flex items-center gap-1">
                        <span class="text-xs text-gray-500">${group.length}项</span>
                        <button 
                            onclick="copyGroupData(${index})" 
                            class="px-1 py-0.5 bg-blue-500 text-white text-xs rounded hover:bg-blue-600 transition-colors"
                            title="复制本组数据"
                        >
                            复制
                        </button>
                    </div>
                </div>
                <div class="max-h-32 overflow-y-auto">
                    <div class="text-xs space-y-1" id="group-${index}-data">
                        ${group.map(item => `<div class="p-1 bg-gray-50 rounded text-center hover:bg-gray-100 transition-colors">${item}</div>`).join('')}
                    </div>
                </div>
            `;
        }
        
        resultsContainer.appendChild(groupDiv);
    });
}

// 复制组数据功能
function copyGroupData(groupIndex) {
    const groupDataDiv = document.getElementById(`group-${groupIndex}-data`);
    if (!groupDataDiv) {
        alert('未找到数据');
        return;
    }
    
    // 提取所有数据项
    const dataItems = Array.from(groupDataDiv.querySelectorAll('div')).map(div => div.textContent.trim());
    const dataText = dataItems.join(',');
    
    // 复制到剪贴板
    if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(dataText).then(() => {
            // 显示复制成功提示
            showCopySuccess(groupIndex);
        }).catch(err => {
            console.error('复制失败:', err);
            fallbackCopyTextToClipboard(dataText, groupIndex);
        });
    } else {
        fallbackCopyTextToClipboard(dataText, groupIndex);
    }
}

// 备用复制方法
function fallbackCopyTextToClipboard(text, groupIndex) {
    const textArea = document.createElement('textarea');
    textArea.value = text;
    textArea.style.position = 'fixed';
    textArea.style.left = '-999999px';
    textArea.style.top = '-999999px';
    document.body.appendChild(textArea);
    textArea.focus();
    textArea.select();
    
    try {
        const successful = document.execCommand('copy');
        if (successful) {
            showCopySuccess(groupIndex);
        } else {
            alert('复制失败，请手动选择复制');
        }
    } catch (err) {
        console.error('复制失败:', err);
        alert('复制失败，请手动选择复制');
    }
    
    document.body.removeChild(textArea);
}

// 显示复制成功提示
function showCopySuccess(groupIndex) {
    const button = document.querySelector(`button[onclick="copyGroupData(${groupIndex})"]`);
    if (button) {
        const originalText = button.innerHTML;
        button.innerHTML = '<i class="fa fa-check"></i> 已复制';
        button.classList.remove('bg-blue-500', 'hover:bg-blue-600');
        button.classList.add('bg-green-500');
        
        setTimeout(() => {
            button.innerHTML = originalText;
            button.classList.remove('bg-green-500');
            button.classList.add('bg-blue-500', 'hover:bg-blue-600');
        }, 1500);
    }
}

// 渲染验证结果
function renderValidationResults(validation) {
    const validationContainer = document.getElementById('validationResults');
    const validationContent = document.getElementById('validationContent');
    
    if (!validation || !validation.results) {
        validationContainer.classList.add('hidden');
        return;
    }
    
    validationContainer.classList.remove('hidden');
    
    let html = `
        <div class="mb-4">
            <div class="text-sm text-gray-600 mb-2">
                总数据量: ${validation.total_data_size} 注 | 
                验证组合数: ${validation.combinations_count} 个 | 
                整体验证: ${validation.all_valid ? '<span class="text-green-600 font-semibold">✅ 通过</span>' : '<span class="text-red-600 font-semibold">❌ 失败</span>'}
            </div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
    `;
    
    Object.entries(validation.results).forEach(([comboKey, result]) => {
        const comboText = result.combo.map(i => `组${i + 1}`).join(' + ');
        const statusClass = result.is_complete ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200';
        const statusIcon = result.is_complete ? '✅' : '❌';
        
        html += `
            <div class="${statusClass} border rounded-lg p-3">
                <div class="font-medium text-sm">${comboText}</div>
                <div class="text-xs text-gray-600 mt-1">
                    ${result.size}注 (${(result.coverage * 100).toFixed(1)}%) ${statusIcon}
                </div>
            </div>
        `;
    });
    
    html += '</div>';
    validationContent.innerHTML = html;
}function H(t,e){const n={};return e.forEach(e=>{let o=0,c=0,r=0,i=0;t.forEach(t=>{t.cells[e].hit?(r++,i=0,r>o&&(o=r)):(i++,r=0,i>c&&(c=i))}),n[e]={maxHit:o,maxMiss:c}}),n}function U(t,e){const n={};return e.forEach(e=>{let o=0;for(let n=0;n<t.length&&t[n].cells[e].hit;n++)o++;n[e]=o}),n}function z(t,e){const n={};return e.forEach(e=>{let o=0;for(let n=0;n<t.length&&!t[n].cells[e].hit;n++)o++;n[e]=o}),n}function L(){const t=document.querySelector("#resultTable thead"),e=document.querySelector("#resultTable tbody");t.innerHTML="",e.innerHTML="";if(!r.length){const t=document.createElement("tr"),n=document.createElement("td");return n.colSpan=100,n.className="py-4 text-center text-gray-500",n.textContent="暂无数据，请先输入或获取数据",t.appendChild(n),e.appendChild(t),void j()}const n=r.slice(0,f);totalPages=Math.ceil(n.length/pageSize);const o=+document.querySelector("#numButtons .btn-active")?.dataset.num||0,c=Array.from(document.querySelectorAll("#hitButtons .btn-active")).map(t=>+t.dataset.hit),i=[...Array(10)].map((t,e)=>e+1),a=[...o>0&&o<=10?R(i,o):[],...document.getElementById("customCombos").value.trim().split(/\s+/).filter(Boolean).map(t=>t.split(",").map(t=>+t).filter(t=>!isNaN(t)))].filter(t=>t.length>0).map(t=>t.join(",")),s=n.map(t=>({rec:t,cells:{}}));a.forEach(t=>{let e=0;for(let n=s.length-1;n>=0;n--){const o=s[n].rec,r=t.split(",").map(t=>+t).filter(t=>o.data.slice(0,5).includes(t)).length;c.length&&c.includes(r)?(s[n].cells[t]={txt:t,hit:!0},e=0):(e++,s[n].cells[t]={txt:e,hit:!1})}});const d=H(s,a),u=U(s,a),l=z(s,a),b=a.slice().sort((t,e)=>{if(y){const{maxHit:n,maxMiss:o}=d[t],{maxHit:c,maxMiss:r}=d[e];return m?c-n||o-r:o-r||c-n}return m?u[e]-u[t]||l[t]-l[e]:l[t]-l[e]||u[e]-u[t]});document.getElementById("sortText").textContent=m?"按遗漏次数排序":"按连中次数排序";const startIndex=(currentPage-1)*pageSize,endIndex=Math.min(startIndex+pageSize,s.length),pageData=s.slice(startIndex,endIndex);document.getElementById("summary").innerHTML=`\n        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">\n          <div>共 ${b.length} 注分析组合</div>\n          <div>当前显示: ${n.length} 期 / 总计: ${r.length} 期</div>\n          <div>筛选条件: ${o}码组合，命中${c.length>0?c.join("/"):"全部"}胆</div>\n          <div>第 ${currentPage}/${totalPages} 页 (${pageData.length}/${s.length} 行)</div>\n        </div>\n        <div class="flex justify-center items-center mt-4 space-x-2">\n          <button id="prevPage" class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300 disabled:opacity-50" ${currentPage<=1?'disabled':''}>上一页</button>\n          <span class="text-sm text-gray-600">第 ${currentPage} 页，共 ${totalPages} 页</span>\n          <button id="nextPage" class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300 disabled:opacity-50" ${currentPage>=totalPages?'disabled':''}>下一页</button>\n        </div>`;const h=document.createElement("tr");h.className="bg-gray-50",h.innerHTML='\n        <th class="px-3 py-2 text-left sticky-col left-0 border-r border-gray-200 fixed-width-period sticky-bg-white">期数</th>\n        <th class="px-3 py-2 text-left sticky-col left-[120px] border-r border-gray-200 fixed-width-data sticky-bg-white">数据</th>\n      ',b.forEach(t=>{const{maxHit:e,maxMiss:n}=d[t],o=document.createElement("th");o.className="px-3 py-2 text-center border-r border-gray-200",o.innerHTML=y?m?`\n              <div class="font-medium">${t}</div>\n              <div class="text-xs text-gray-500">连:${e}</div>\n            `:`\n              <div class="font-medium">${t}</div>\n              <div class="text-xs text-gray-500">漏:${n}</div>\n            `:m?`\n              <div class="font-medium">${t}</div>\n              <div class="text-xs text-gray-500">连:${u[t]}</div>\n            `:`\n              <div class="font-medium">${t}</div>\n              <div class="text-xs text-gray-500">漏:${l[t]}</div>\n            `,h.appendChild(o)}),t.appendChild(h),pageData.forEach((t,n)=>{const o=document.createElement("tr");o.className=0===n?"bg-gray-100":1===n?"bg-gray-50":"",o.innerHTML=`\n          <td class="px-3 py-2 text-left sticky-col left-0 border-r border-gray-200 font-medium fixed-width-period ${0===n?"sticky-bg-gray-100":1===n?"sticky-bg-gray-50":"sticky-bg-white"}">${t.rec.period}</td>\n          <td class="px-3 py-2 text-left sticky-col left-[120px] border-r border-gray-200 fixed-width-data ${0===n?"sticky-bg-gray-100":1===n?"sticky-bg-gray-50":"sticky-bg-white"}">\n            <div class="number-row">${t.rec.data.slice(0,5).join(",")}</div>\n            <div class="number-row">${t.rec.data.slice(5).join(",")}</div>\n          </td>\n        `,b.forEach(e=>{const n=t.cells[e],c=document.createElement("td");c.className="px-3 py-2 text-center border-r border-gray-200 "+(n.hit?"hit-cell":"miss-cell"),c.textContent=n.txt,o.appendChild(c)}),e.appendChild(o)}),setTimeout(()=>{const t=document.getElementById("prevPage"),e=document.getElementById("nextPage");t&&t.addEventListener("click",()=>{currentPage>1&&(currentPage--,L())}),e&&e.addEventListener("click",()=>{currentPage<totalPages&&(currentPage++,L())})},100),j()}function j(){const t=document.getElementById("resultTable"),e=document.getElementById("tableContainer"),n=t.offsetWidth,o=e.offsetWidth;if(n>o){document.querySelector(".slider-container").style.display="block";const u=o/n,l=Math.max(20,u*o);k.style.width=e.scrollLeft/(n-o)*100+"%",w.style.left=e.scrollLeft/(n-o)*(o-l)+"px",w.style.width=`${l}px`,k.style.width=e.scrollLeft/(n-o)*100+"%";let m=!1;function c(t){if(!m)return;const c=e.getBoundingClientRect(),r=t.clientX-c.left-l/2,i=o-l,a=Math.max(0,Math.min(r,i)),s=a/i,d=s*(n-o);e.scrollLeft=d,w.style.left=`${a}px`,k.style.width=100*s+"%"}function r(){m=!1,document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",r)}w.addEventListener("mousedown",t=>{m=!0,document.addEventListener("mousemove",c),document.addEventListener("mouseup",r),t.preventDefault()}),document.querySelector(".slider-track").addEventListener("click",t=>{const c=e.getBoundingClientRect(),r=t.clientX-c.left-l/2,i=o-l,a=Math.max(0,Math.min(r,i)),s=a/i,d=s*(n-o);e.scrollLeft=d,w.style.left=`${a}px`,k.style.width=100*s+"%"})}else document.querySelector(".slider-container").style.display="none";const i=t.offsetHeight,a=e.offsetHeight;if(i>a){$.style.display="flex";const f=a/i,y=Math.max(20,f*a);I.style.height=e.scrollTop/(i-a)*100+"%",B.style.top=e.scrollTop/(i-a)*(a-y)+"px",B.style.height=`${y}px`,I.style.height=e.scrollTop/(i-a)*100+"%";let b=!1;function s(t){if(!b)return;const n=e.getBoundingClientRect(),o=t.clientY-n.top-y/2,c=a-y,r=Math.max(0,Math.min(o,c)),s=r/c,d=s*(i-a);e.scrollTop=d,B.style.top=`${r}px`,I.style.height=100*s+"%"}function d(){b=!1,document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",d)}B.addEventListener("mousedown",t=>{b=!0,document.addEventListener("mousemove",s),document.addEventListener("mouseup",d),t.preventDefault()}),document.querySelector(".vertical-slider-track").addEventListener("click",t=>{const n=e.getBoundingClientRect(),o=t.clientY-n.top-y/2,c=a-y,r=Math.max(0,Math.min(o,c)),s=r/c,d=s*(i-a);e.scrollTop=d,B.style.top=`${r}px`,I.style.height=100*s+"%"})}else $.style.display="none";e.addEventListener("scroll",()=>{if(n>o){const t=e.scrollLeft/(n-o);w.style.left=t*(o-parseInt(getComputedStyle(w).width))+"px",k.style.width=100*t+"%"}if(i>a){const t=e.scrollTop/(i-a);B.style.top=t*(a-parseInt(getComputedStyle(B).height))+"px",I.style.height=100*t+"%"}})}async function V(){if(s)try{const t=await s.getFile(),e=(await t.text()).trim().split("\n").filter(Boolean);for(const t of e)q(t);r.sort((t,e)=>{const n=t.period.toString();return e.period.toString().localeCompare(n)}),document.getElementById("periodCount").textContent=r.length,L()}catch(t){v.textContent=`读取文件错误: ${t.message}`}}async function W(){if(s)try{const t=await s.getFile(),e=(await t.text()).trim().split("\n")[0],n=e.trim().split(/\t+/);if(2!==n.length)return;const o=n[0].trim();if(o===u)return;u=o,q(e),document.getElementById("periodCount").textContent=r.length,L()}catch(t){}}function q(t){let e;if(t.includes("\t"))e=t.trim().split(/\t+/);else{if(!t.includes(" "))return;e=t.trim().split(/\s+/)}if(e.length<2)return;const n=e[0].trim();if(d.has(n))return;let o;if(e[1].includes(","))o=e[1].split(",").map(t=>parseInt(t.trim(),10));else{if(!e[1].includes(" "))return;o=e[1].split(" ").map(t=>parseInt(t.trim(),10))}10!==o.length||o.some(isNaN)||(d.add(n),r.unshift({period:n,data:o,input:o.join(",")}))}P.addEventListener("click",async function(){const t=p.value.trim();if(t){this.disabled=!0,this.textContent="验证中...";try{const e=await A(t);if(e.valid){// 标记密钥为已使用
await markKeyAsUsedOnline(e.data.nonce);
// 记录密钥使用信息到后台
await recordKeyUsage(e.data);
const n=Y();localStorage.setItem(`validKey_${n}`,t),localStorage.setItem(`keyExpiry_${n}`,e.data.expiry),g.classList.add("hidden"),g.style.display="none",b=!0,D(e.data.expiry)}else alert("密钥验证失败: "+e.reason)}catch(t){console.error("密钥验证过程出错:",t),alert("验证过程中发生错误: "+t.message)}finally{this.disabled=!1,this.textContent="验证密钥"}}else alert("请输入密钥")}),window.addEventListener("load",async function(){try{const t=Y(),e=localStorage.getItem(`validKey_${t}`),n=localStorage.getItem(`keyExpiry_${t}`),o=Math.floor((new Date).getTime()/1e3);if(e&&n){const r=parseInt(n);if(o<r){// 密钥未过期，但需要在线验证是否已被使用
try{const keyData=JSON.parse(atob(e.split('.')[1]));const isUsed=await checkKeyOnlineUsage(keyData.nonce);if(isUsed){localStorage.removeItem(`validKey_${t}`),localStorage.removeItem(`keyExpiry_${t}`),b=!1,alert("密钥已被使用，请重新验证密钥"),g.classList.remove("hidden"),g.style.display="flex"}else{b=!0,D(r),g.classList.add("hidden"),g.style.display="none"}}catch(err){console.error("在线验证失败，使用本地验证:",err);b=!0,D(r),g.classList.add("hidden"),g.style.display="none"}}else{localStorage.removeItem(`validKey_${t}`),localStorage.removeItem(`keyExpiry_${t}`),b=!1,alert("您的访问密钥已过期，请重新验证密钥"),g.classList.remove("hidden"),g.style.display="flex"}}else b=!1,g.classList.remove("hidden"),g.style.display="flex"}catch(t){console.error("页面加载时密钥检查出错:",t),b=!1,g.classList.remove("hidden"),g.style.display="flex"}}),document.getElementById("calcBtn").addEventListener("click",F),document.getElementById("numbersInput").addEventListener("keydown",t=>{"Enter"!==t.key||t.shiftKey||(t.preventDefault(),F())}),document.getElementById("autoFetchBtn").addEventListener("click",()=>{a?(clearInterval(a),a=null,document.getElementById("autoFetchBtn").innerHTML='<i class="fa fa-refresh mr-2"></i>自动获取数据',v.textContent="已停止自动获取"):(J(),a=setInterval(J,5e3),document.getElementById("autoFetchBtn").innerHTML='<i class="fa fa-stop mr-2"></i>停止自动获取',v.textContent="已开始自动获取数据，每5秒更新一次")}),document.getElementById("sortToggle").addEventListener("click",()=>{m=!m,L()}),document.getElementById("currentBtn").addEventListener("click",()=>{y=!0,document.getElementById("currentBtn").classList.add("btn-active","bg-blue-600","text-white"),document.getElementById("currentBtn").classList.remove("bg-gray-200","text-gray-700"),document.getElementById("historyBtn").classList.remove("btn-active","bg-blue-600","text-white"),document.getElementById("historyBtn").classList.add("bg-gray-200","text-gray-700"),L()}),document.getElementById("historyBtn").addEventListener("click",()=>{y=!1,document.getElementById("historyBtn").classList.add("btn-active","bg-blue-600","text-white"),document.getElementById("historyBtn").classList.remove("bg-gray-200","text-gray-700"),document.getElementById("currentBtn").classList.remove("btn-active","bg-blue-600","text-white"),document.getElementById("currentBtn").classList.add("bg-gray-200","text-gray-700"),L()}),document.getElementById("missBtn").addEventListener("click",()=>{m=!1,document.getElementById("missBtn").classList.add("btn-active","bg-blue-600","text-white"),document.getElementById("missBtn").classList.remove("bg-gray-200","text-gray-700"),document.getElementById("hitBtn").classList.remove("btn-active","bg-blue-600","text-white"),document.getElementById("hitBtn").classList.add("bg-gray-200","text-gray-700"),L()}),document.getElementById("hitBtn").addEventListener("click",()=>{m=!0,document.getElementById("hitBtn").classList.add("btn-active","bg-blue-600","text-white"),document.getElementById("hitBtn").classList.remove("bg-gray-200","text-gray-700"),document.getElementById("missBtn").classList.remove("btn-active","bg-blue-600","text-white"),document.getElementById("missBtn").classList.add("bg-gray-200","text-gray-700"),L()}),document.getElementById("statBtn").addEventListener("click",L),document.getElementById("exportBtn").addEventListener("click",()=>{if(!r.length)return void(v.textContent="没有数据可导出");let t="期数,数据\n";r.forEach(e=>{t+=`${e.period},${e.input}\n`});const e=new Blob([t],{type:"text/csv;charset=utf-8;"}),n=URL.createObjectURL(e),o=document.createElement("a");o.setAttribute("href",n),o.setAttribute("download",`台湾PK数据_${(new Date).toISOString().slice(0,10)}.csv`),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o),v.textContent="数据已导出"}),document.getElementById("clearBtn").addEventListener("click",()=>{confirm("确定要清空所有数据吗？此操作不可恢复。")&&(r=[],i=1,d.clear(),document.getElementById("periodCount").textContent="0",document.getElementById("summary").textContent="",L(),v.textContent="数据已清空")}),document.addEventListener("DOMContentLoaded",()=>{document.getElementById("uploadDataBtn").addEventListener("click",async()=>{try{[s]=await window.showOpenFilePicker(),d.clear(),u=null,r=[],i=1,await V(),l&&clearInterval(l),l=setInterval(W,3e3),v.textContent=`已加载文件: ${s.name}`}catch(t){v.textContent=`文件选择错误: ${t.message}`}})});const G=document.getElementById("helpModal");document.getElementById("helpBtn").addEventListener("click",()=>{G.classList.remove("hidden")}),document.getElementById("closeHelpBtn").addEventListener("click",()=>{G.classList.add("hidden")}),document.getElementById("gotItBtn").addEventListener("click",()=>{G.classList.add("hidden")}),G.addEventListener("click",t=>{t.target===G&&G.classList.add("hidden")});let Q=!1;document.getElementById("themeToggle").addEventListener("click",()=>{Q=!Q,document.body.classList.toggle("bg-gray-900",Q),document.body.classList.toggle("text-white",Q),document.body.classList.toggle("bg-gray-50",!Q),document.body.classList.toggle("text-dark",!Q);const t=document.getElementById("themeToggle").querySelector("i");t.classList.toggle("fa-moon-o",!Q),t.classList.toggle("fa-sun-o",Q)});const X=document.querySelectorAll(".period-btn");function Y(){try{const t=document.documentElement.outerHTML.substring(0,1e3)+window.location.href.split("/").slice(-2).join("/");let e=0;for(let n=0;n<t.length;n++)e=(e<<5)-e+t.charCodeAt(n),e&=e;return"file_"+Math.abs(e).toString(36)}catch(t){return console.error("Failed to generate file identifier:",t),"fallback_"+Date.now()}}X.forEach(t=>{t.addEventListener("click",()=>{X.forEach(t=>t.classList.remove("btn-active")),t.classList.add("btn-active"),f=parseInt(t.dataset.period),document.getElementById("customPeriod").value=f,L()})}),document.getElementById("customPeriodBtn").addEventListener("click",()=>{const t=parseInt(document.getElementById("customPeriod").value);!isNaN(t)&&t>=1&&t<=1e4?(f=t,X.forEach(t=>t.classList.remove("btn-active")),L()):alert("请输入1-10000之间的数字")}),window.addEventListener("resize",j),L();

// 黄金切割页面事件处理
document.addEventListener('DOMContentLoaded', function() {
    // 输入数据计数
    const goldenInputData = document.getElementById('goldenInputData');
    const goldenInputCount = document.getElementById('goldenInputCount');
    
    if (goldenInputData && goldenInputCount) {
        goldenInputData.addEventListener('input', function() {
            const data = this.value.trim();
            if (!data) {
                goldenInputCount.classList.add('hidden');
                return;
            }
            
            // 解析输入数据
            const items = data.split(/[\n,;，]+/).map(s => s.trim()).filter(s => s);
            goldenInputCount.textContent = `共 ${items.length} 项`;
            goldenInputCount.classList.remove('hidden');
        });
    }
    
    // 分割按钮
    const goldenSplitBtn = document.getElementById('goldenSplitBtn');
    if (goldenSplitBtn) {
        goldenSplitBtn.addEventListener('click', function() {
            const inputData = document.getElementById('goldenInputData').value.trim();
            
            if (!inputData) {
                alert('请输入要分割的数据');
                return;
            }
            
            // 解析输入数据
            const items = inputData.split(/[\n,;，]+/).map(s => s.trim()).filter(s => s);
            
            if (items.length === 0) {
                alert('没有有效的数据');
                return;
            }
            
            // 执行黄金切割
            const groups = splitTo5in4General(items);
            
            // 渲染结果
            renderGoldenResults(groups);
            
            // 隐藏验证结果
            document.getElementById('validationResults').classList.add('hidden');
            
            console.log('分割完成:', groups);
        });
    }
    
    // 粘贴数据按钮
    const goldenPasteBtn = document.getElementById('goldenPasteBtn');
    if (goldenPasteBtn) {
        goldenPasteBtn.addEventListener('click', async function() {
            try {
                // 检查剪贴板API是否可用
                if (!navigator.clipboard || !navigator.clipboard.readText) {
                    // 降级到传统方法
                    const textarea = document.createElement('textarea');
                    document.body.appendChild(textarea);
                    textarea.focus();
                    document.execCommand('paste');
                    const text = textarea.value;
                    document.body.removeChild(textarea);
                    
                    if (text.trim()) {
                        document.getElementById('goldenInputData').value = text.trim();
                        // 触发输入事件以更新计数
                        const inputEvent = new Event('input', { bubbles: true });
                        document.getElementById('goldenInputData').dispatchEvent(inputEvent);
                    }
                    return;
                }
                
                // 尝试从剪贴板读取数据
                const text = await navigator.clipboard.readText();
                if (text.trim()) {
                    document.getElementById('goldenInputData').value = text.trim();
                    
                    // 触发输入事件以更新计数
                    const inputEvent = new Event('input', { bubbles: true });
                    document.getElementById('goldenInputData').dispatchEvent(inputEvent);
                } else {
                    alert('剪贴板为空');
                }
            } catch (err) {
                console.error('无法访问剪贴板:', err);
                // 提示用户使用快捷键粘贴
                alert('请使用 Ctrl+V (Windows) 或 Cmd+V (Mac) 手动粘贴数据到输入框');
            }
        });
    }
    
    // 清空按钮
    const goldenClearBtn = document.getElementById('goldenClearBtn');
    if (goldenClearBtn) {
        goldenClearBtn.addEventListener('click', function() {
            // 清空输入
            document.getElementById('goldenInputData').value = '';
            document.getElementById('goldenInputCount').classList.add('hidden');
            
            // 清空结果
            document.getElementById('goldenResults').innerHTML = '';
            document.getElementById('validationResults').classList.add('hidden');
            
            console.log('已清空所有数据');
        });
    }
});


</script>
</body>
</html>
